/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

function number_format(number, decimals, dec_point, thousands_sep) {
    // *     example 1: number_format(1234.56);
    // *     returns 1: '1,235'
    // *     example 2: number_format(1234.56, 2, ',', ' ');
    // *     returns 2: '1 234,56'
    // Strip all characters but numerical ones.
    number = (number + '').replace(/[^0-9+\-Ee.]/g, '');
    var n = !isFinite(+number) ? 0 : +number,
            prec = !isFinite(+decimals) ? 0 : Math.abs(decimals),
            sep = (typeof thousands_sep === 'undefined') ? ',' : thousands_sep,
            dec = (typeof dec_point === 'undefined') ? '.' : dec_point,
            s = '',
            toFixedFix = function (n, prec) {
                var k = Math.pow(10, prec);
                return '' + Math.round(n * k) / k;
            };
    // Fix for IE parseFloat(0.55).toFixed(0) = 0;
    s = (prec ? toFixedFix(n, prec) : '' + Math.round(n)).split('.');
    if (s[0].length > 3) {
        s[0] = s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g, sep);
    }
    if ((s[1] || '').length < prec) {
        s[1] = s[1] || '';
        s[1] += new Array(prec - s[1].length + 1).join('0');
    }
    return s.join(dec);
}
//nguyenlong

var guid = function () {
    if (!$.cookie.get('guid')) {
        var guid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
            var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
            return v.toString(16);
        });
        var d = new Date();
        d.setTime(d.getTime() + (1000 * 24 * 60 * 60 * 365 * 5));
        $.cookie.set('guid', guid, d, '/');
        return guid;
    } else {
        return $.cookie.get('guid');
    }
};

function init_youtube()
{
    var vidDefer = document.getElementsByTagName('iframe');
    for (var i=0; i<vidDefer.length; i++)
    {
        if(vidDefer[i].getAttribute('data-src'))
        {
            vidDefer[i].setAttribute('src',vidDefer[i].getAttribute('data-src'));
        }
    }
}

window.onload = init_youtube;

$(document).ready(function () {
    //xu ly scroll trang detail
    var $tyghHeader = false;
    $(window).scroll(function () {
        if ($('.tygh-header').length > 0) {
            $tyghHeader = $('.tygh-header').offset().top;
        }
        var $endNav = false;
        if ($('.tygh-top-panel').length > 0) {
            $endNav = $('.tygh-top-panel').offset().top;
        }
        var scrolled_val = $(document).scrollTop().valueOf();

        if (scrolled_val >= $tyghHeader-$endNav) {
            $('.tygh-top-panel').addClass('tygh-top-panel-fullbar');
        } else {
            $('.tygh-top-panel').removeClass('tygh-top-panel-fullbar');
        }
        if (scrolled_val == 0) {
            $('.tygh-top-panel').removeClass('tygh-top-panel-fullbar');
        }
    });

    

    /**
     * State Change
     */
    $(".cm-country").each(function (index) {
        country_code = $(this).find('option:selected').val();
        if (country_code == 'VN') {
            $(this).parent().parent().find(".select-districts").find('label').addClass("cm-required");
            //$(this).parent().parent().find(".billing-zip-code").hide();
        } else {
            $(this).parent().parent().find(".select-districts").find('label').removeClass("cm-required");
            //$(this).parent().parent().find(".billing-zip-code").show();
        }
    });

    $(document).on('change', '.cm-country', function () {
        country_code = $(this).find('option:selected').val();

        if (country_code == 'VN') {
            $(this).parent().parent().find(".select-districts").find('label').addClass("cm-required");
            //$(this).parent().parent().find(".billing-zip-code").hide();
        } else {
            $(this).parent().parent().find(".select-districts").find('label').removeClass("cm-required");
            //$(this).parent().parent().find(".billing-zip-code").show();
        }
        $(this).parent().parent().find(".select-districts").find('select').children().remove();
        $(this).parent().parent().find(".select-districts").find('select').append("<option value=''>" + $(this).parent().parent().find(".select-districts").parent().find(".select_district").val() + "</option>");
        $(this).parent().parent().find(".select-districts").next().find('select').children().remove();
        $(this).parent().parent().find(".select-districts").next().find('select').append("<option value=''>" + $(this).parent().parent().find(".select-districts").next().parent().find(".select_ward").val() + "</option>");
        select_district('', country_code, '', false, $(this));
    });

    $(".select_state").each(function (index) {
        address_type = $(this).hasClass("cm-location-shipping") ? "cm-location-shipping" : "cm-location-billing";
        state_code = $(this).find('option:selected').val();
        var country_code = $(".cm-country." + address_type).val();
        select_district(state_code, country_code, address_type, false, $(this));
    });

    $(document).on('change', '.cm-state', function () {
        address_type = $(this).hasClass("cm-location-shipping") ? "cm-location-shipping" : "cm-location-billing";
        state_code = $(this).find('option:selected').val();
        country_code = $(".cm-country." + address_type).val();
        if (country_code == 'VN') {
            $(this).parent().parent().find(".select-districts").find('label').addClass("cm-required");
        } else {
            $(this).parent().parent().find(".select-districts").find('label').removeClass("cm-required");
        }
        select_district(state_code, country_code, address_type, false, $(this));

    });
    /* Update | Hà Phan Minh | 2014-04-29 */
    $(document).on('change', '.cm-district', function () {
        address_type = $('.billing-state').find('.cm-state').hasClass("cm-location-shipping") ? "cm-location-shipping" : "cm-location-billing";
        state_code = $('.cm-state').find('option:selected').val();
        country_code = $(".cm-country." + address_type).val();
        district_id = $(this).val();
        select_street(state_code, country_code, address_type, district_id);
        select_ward(state_code, country_code, address_type, district_id, false, $(this));
    });

    $(document).ready(function () {
        $('.validatePhone').inputmask('Regex', {
            regex: "[090|093|091|094|092|095|096|097|098|099|0120|0121|0122|0126|0128|0162|0163|0164|0165|0166|0167|0168|0169|0123|0124|0125|0127|0129|0188|0186|0199]{3,4}[0-9]{7}"
        });
        $('.validateOtherPhone').inputmask('Regex', {
            regex: "[0]{1}[0-9]{9,10}"
        });
    });

    $(document).on("keydown.autocomplete", ".search_street", function (e) {
        var $this = $(this);
        var state_code = $this.parent().parent().find('.shipping-state').find('.select_state').val();
        if (typeof state_code === "undefined") {
            var state_code = $this.parent().parent().find('.billing-state').find('.select_state').val();
        }
        var district_id = $this.parent().parent().find('.select-districts').find('.cm-district').val();

        $(this).autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: "?dispatch=streets.ajax_street",
                    dataType: "jsonp",
                    data: {
                        featureClass: "P",
                        style: "full",
                        maxRows: 12,
                        street_name: request.term,
                        district_id: district_id,
                        state_id: state_code
                    },
                    success: function (data) {
                        response($.map(data, function (item) {
                            return {
                                label: item.street_name,
                                value: item.street_name,
                                street_id: item.street_id
                            }
                        }));
                    }
                });
            },
            minLength: 1,
            select: function (event, ui) {
                $this.next().val(ui.item.street_id);
            },
            open: function () {
                // $(this).removeClass("ui-corner-all").addClass("ui-corner-top");
            },
            close: function () {
                // $(this).removeClass("ui-corner-top").addClass("ui-corner-all");
            }
        });
    });

    $('.categories-title').click(function () {
        if ($('body').hasClass('page-index-index') == false) {
            $('.categories-content').slideToggle('fast');
        }
    });
    $('.vnb-check-add-to-cart').change(function () {
        $('.add-to-cart-product-e').attr('disabled', 'disabled');
        var $pid = $(this).val();
        $('.select-pid-' + $pid).toggleClass('opacity-20');
        var $price = 0;
        $('.vnb-check-add-to-cart').each(function (index, $v) {
            if ($($v).is(':checked')) {
                $('.add-to-cart-product-' + $($v).val()).removeAttr('disabled');
                $price += parseInt($($v).attr('data-price'));
            }
        });
        $('.product-total-content .price-total .price').text(number_format($price, 0, ',', '.') + ' đ');
    });
    $(document).on('click', '.reply-comment-action', function (e) {
        $(this).parent().find('.comment-box-reply').fadeIn();
    });
    $(document).on('click', '.cancel-reply', function (e) {
        $(this).parents('.comment-box-reply').fadeOut();
    });
    $(document).on('click', '.submit-reply', function (e) {
        e.preventDefault();
        var $check = true;
        var $dataForm = $(this).attr('data-form');
        if ($('#' + $dataForm).find('.block_auth').length > 0) {
            var $name = $('#' + $dataForm).find('.input-name');
            $name.removeClass('cm-failed-field').parent().removeClass('error').find('label').removeClass('cm-failed-label');
            $name.parent().find('.cm-status-field').html('');

            if ($.trim($name.val()) == '') {
                $name.addClass('cm-failed-field').parent().addClass('error').find('label').addClass('cm-failed-label');
                $name.parent().find('.cm-status-field').html('<span class="help-inline">Bạn phải nhập <strong>Họ tên</strong></span>')
                $check = false;
            }
            var $email = $('#' + $dataForm).find('.input-email');
            $email.removeClass('cm-failed-field').parent().removeClass('error').find('label').removeClass('cm-failed-label');
            $email.parent().find('.cm-status-field').html('');
            if ($.is.email($email.val()) == false) {
                $email.addClass('cm-failed-field').parent().addClass('error').find('label').addClass('cm-failed-label');
                $email.parent().find('.cm-status-field').html('<span class="help-inline"><b>Email</b> không hợp lệ</span>')
                $check = false;
            }
        }

        var $mes = $('#' + $dataForm).find('.cm-textarea');
        $mes.parent().find('.cm-status-mes').html('');
        $mes.removeClass('cm-failed-field');

        if ($mes.val() == '') {
            $mes.addClass('cm-failed-field');
            $mes.parent().find('.cm-status-mes').html('<span class="help-inline">Bạn chưa nhập nội dung</span>')
            $check = false;
        }

        if ($check == true) {
            var $data = $('#' + $dataForm).serializeArray();
            $.ajax({
                url: "?dispatch=discussion.post_reply",
                type: 'POST',
                dataType: "json",
                data: $data,
                success: function (data) {
                    var $data = $.parseJSON(data.text);
                    $.ceNotification('show', {
                        type: $data.type,
                        title: $data.title,
                        message: $data.message,
                        message_state: $data.message_state
                    });
                    if ($data.type == 'W') {
                        $('.comment-box-reply').fadeOut();
                    }
                }
            });
        }
    });
    $('.header-login-dropdown-profiles').hover(function () {
        $('.header-login-dropdown-profiles-content').stop().fadeIn('fast');
    }, function () {
        $('.header-login-dropdown-profiles-content').stop().hide();
    });
    $('.comment-item .readmore').click(function () {
        $(this).prev().toggleClass('cm-content-more');
        if ($(this).prev().hasClass('cm-content-more')) {
            $(this).text('Xem chi tiết');
        } else {
            $(this).text('Rút gọn');
        }
    });
    //auto autocomplete for searh frontend
    // $(document).on("keydown.autocomplete", ".header-search-input", function (e) {
    //     $(this).autocomplete({
    //         source: function (request, response) {
    //             var $key = request.term.toString();

    //             $.ajax({
    //                 url: "?dispatch=products.suggest",
    //                 type: 'POST',
    //                 async: false,
    //                 cache: true,
    //                 data: {'text': $key},
    //                 success: function (data_first) {
    //                     data_first = JSON.parse(data_first);
    //                     if (data_first !== null && data_first.length > 0) {
    //                         var $response = data_first;
    //                         response($response);
    //                     }
    //                 }
    //             });
    //         },
    //         minLength: 1,
    //         select: function (event, ui) {
    //             trackEvent('search suggest', 'click', ui.item.label);
    //             if (ui.item.seo_name) {
    //                 window.location.href = ui.item.seo_name + '.html';
    //             } else {
    //                 $('#search-form-header').submit();
    //             }
    //         },
    //         open: function () {
    //             $(this).removeClass("ui-corner-all").addClass("ui-corner-top");
    //         },
    //         close: function () {
    //             $(this).removeClass("ui-corner-top").addClass("ui-corner-all");
    //         },
    //         appendTo: "#search-autocomplete"
    //     }).data("ui-autocomplete")._renderItem = function (ul, item) {
    //         var $html = '';
    //         if (item.label.length >0 ) {
    //             $html = '<a class="ui-corner-all">';
    //             $html += '<div class="image-thumb-min';
    //             if (item.type == 'author') {
    //                 $html += ' radius ';
    //             }
    //             $html += '">';
    //             if (item.image != '') {
    //                 $html += '<img src="' + item.image + '">';
    //             } else {
    //                 $html += '<img src="/public/images/no_image.png">';
    //             }
    //             $html += '</div>';
    //             $html += '<div class="suggestionlabel">';
    //             $html += '<span class="title">' + item.label + '</span>';
    //             if (item.type != 'book') {
    //                 var $type = '';
    //                 if (item.type == 'author') {
    //                     $type = 'Tác giả';
    //                 }
    //                 if (item.type == 'publisher') {
    //                     $type = 'Nhà phát hành';
    //                 }
    //                 $html += '<span class="type">' + $type + '</span>';
    //             }
    //             if (item.type == 'book') {
    //                 $html += '<div class="detail">';
    //                 if (typeof item.author != 'undefined') {
    //                     $html += '<span>Tác giả: ' + item.author + '</span>';
    //                 }
    //                 $html += '<span class="price">';
    //                 $html += number_format(item.price, 0, ',', '.') + ' ₫';

    //                 if (item.price < item.list_price) {
    //                     $html += ' &nbsp&nbsp&nbsp <b>' + number_format(item.list_price, 0, ',', '.') + ' ₫</b>';
    //                 }
    //                 $html += '</span>';
    //                 $html += '</div>';
    //             }
    //             $html += '</div>';
    //             $html += '</a>';
    //         }
    //         if ($html.length > 0) {
    //             return $('<li class="ui-menu-item suggest-item" role="presentation">').append($html).appendTo(ul);
    //         }
    //         return;
    //     };
    // }).addClass("whatever");

    // $('.header-search-input').autocomplete({
    //     source: function (request, response) {
    //         var $key = request.term.toString();

    //         $.ajax({
    //             url: "?dispatch=products.suggest",
    //             type: 'POST',
    //             async: false,
    //             cache: true,
    //             data: {'text': $key},
    //             success: function (data_first) {
    //                 data_first = JSON.parse(data_first);
    //                 if (data_first !== null && data_first.length > 0) {
    //                     var $response = data_first;
    //                     response($response);
    //                 }
    //             }
    //         });
    //     },
    //     minLength: 1,
    //     select: function (event, ui) {
    //         // trackEvent('search suggest', 'click', ui.item.label);
    //         if (ui.item.seo_name) {
    //             window.location.href = ui.item.seo_name + '.html';
    //         } else {
    //             $('#search-form-header').submit();
    //         }
    //     },
    //     open: function () {
    //         $(this).removeClass("ui-corner-all").addClass("ui-corner-top");
    //     },
    //     close: function () {
    //         $(this).removeClass("ui-corner-top").addClass("ui-corner-all");
    //     },
    //     appendTo: "#search-autocomplete"
    // }).data("ui-autocomplete")._renderItem = function (ul, item) {
    //     var $html = '';
    //     if (item.label.length >0 ) {
    //         $html = '<a class="ui-corner-all">';
    //         $html += '<div class="image-thumb-min';
    //         if (item.type == 'author') {
    //             $html += ' radius ';
    //         }
    //         $html += '">';
    //         if (item.image != '') {
    //             $html += '<img src="' + item.image + '">';
    //         } else {
    //             $html += '<img src="/public/images/no_image.png">';
    //         }
    //         $html += '</div>';
    //         $html += '<div class="suggestionlabel">';
    //         $html += '<span class="title">' + item.label + '</span>';
    //         if (item.type != 'book') {
    //             var $type = '';
    //             if (item.type == 'author') {
    //                 $type = 'Tác giả';
    //             }
    //             if (item.type == 'publisher') {
    //                 $type = 'Nhà phát hành';
    //             }
    //             $html += '<span class="type">' + $type + '</span>';
    //         }
    //         if (item.type == 'book') {
    //             $html += '<div class="detail">';
    //             if (typeof item.author != 'undefined') {
    //                 $html += '<span>Tác giả: ' + item.author + '</span>';
    //             }
    //             $html += '<span class="price">';
    //             $html += number_format(item.price, 0, ',', '.') + ' ₫';

    //             if (item.price < item.list_price) {
    //                 $html += ' &nbsp&nbsp&nbsp <b>' + number_format(item.list_price, 0, ',', '.') + ' ₫</b>';
    //             }
    //             $html += '</span>';
    //             $html += '</div>';
    //         }
    //         $html += '</div>';
    //         $html += '</a>';
    //     }
    //     if ($html.length > 0) {
    //         return $('<li class="ui-menu-item suggest-item" role="presentation">').append($html).appendTo(ul);
    //     }
    //     return;
    // };

    $(document).on("click", ".buttonBelow", function (e) {
        var $this = $(this);
        var inputElement = $this.parent().find('.amountProduct');
        var totalElement = $('.total-sum').attr('price');
        var currentVal = inputElement.val();
        var priceProduct = $this.parent().find('.priceProduct').val();
        if (currentVal > 0) {
            currentVal = parseInt(currentVal) - 1;
            // $('.total-sum').attr('price', parseInt(totalElement)-parseInt(priceProduct));
            // $('.total-sum').text(parseInt(totalElement)-parseInt(priceProduct));
        }
        inputElement.val(currentVal);
    });

    $(document).on("click", ".buttonPush", function (e) {
        var $this = $(this);
        var inputElement = $this.parent().find('.amountProduct');
        var totalElement = $('.total-sum').attr('price');
        var currentVal = inputElement.val();
        var priceProduct = $this.parent().find('.priceProduct').val();
        // if(currentVal < 999){
        currentVal = parseInt(currentVal) + 1;
        //     $('.total-sum').attr('price', parseInt(totalElement)+parseInt(priceProduct));
        //     $('.total-sum').text(parseInt(totalElement)+parseInt(priceProduct));
        // }
        inputElement.val(currentVal);
    });

    $(document).on("click", ".require-login", function (e) {
        $('.header-login .account').trigger('click');
    });

    $(document).on({
        mouseenter: function () {
            $(this).addClass('active');
        },
        mouseleave: function () {
            $(this).removeClass('active');
        }
    }, ".jscroll-item");
    $(document).on("hover", ".require-login", function (e) {
        $('.header-login .account').trigger('click');
    });

    $(document).on({
        mouseenter: function () {
            $(this).addClass('active');
        },
        mouseleave: function () {
            $(this).removeClass('active');
        }
    }, ".template-grid-list .compact,.template-item-first .compact");

    //    $('.template-grid-list .compact,.template-item-first .compact').hover(function () {
    //        $(this).addClass('active');
    //    }, function () {
    //        $(this).removeClass('active');
    //    });

    $(document).on("click", ".nohelpful", function (e) {
        var $this = this;
        $.ajax({
            url: "?dispatch=discussion.post_helpfull",
            dataType: "json",
            type: 'POST',
            data: {
                post_id: $(this).attr('data-post-id'),
                type: 'nohelpful'
            },
            success: function (data) {
                if (data.text) {
                    data = $.parseJSON(data.text);
                    if (data.status == true) {
                        $($this).parent().fadeOut();
                    }
                }
            }
        });
    });
    $(document).on("click", ".helpful", function (e) {
        var $this = this;
        $.ajax({
            url: "?dispatch=discussion.post_helpfull",
            dataType: "json",
            type: 'POST',
            data: {
                post_id: $(this).attr('data-post-id'),
                type: 'helpful'
            },
            success: function (data) {
                if (data.text) {
                    data = $.parseJSON(data.text);
                    if (data.status == true) {
                        $($this).parent().fadeOut();
                    }
                }
            }
        });
    });
    $(document).on('click', 'input[name="dispatch[auth.login]"]', function (e) {
        var guid_input = $('.guid-login-action');
        if (guid_input.length > 0) {
            guid_input.val(guid());
        }
    });
    $(document).on("click", ".wish-link-action", function (e) {
        e.preventDefault();
        var $this = this;
        var active = $($this).attr('data-active');
        if (active == 0) {
            $(this).addClass('active');
            $($this).attr('data-active', 1);
        } else {
            $(this).removeClass('active');
            $($this).attr('data-active', 0);
        }
        var product_id = $($this).attr('data-product_id');
        // console.log(product_id);
        if (typeof product_id != 'undefined') {
            var $data = new Array();
            $data[product_id] = {
                'product_id': product_id,
                'amount': 1
            };
            $.ajax({
                url: "?dispatch=wishlist.add_custom",
                type: 'POST',
                data: 'product_data=' + product_id + '&active=' + active,
                success: function (data) {
                    Tygh.$.ceNotification('show', {
                        type: 'W',
                        title: 'Thông báo',
                        message: data
                    });
                }
            });
        }
    });
    $(document).on("click", "#button-submit-comment", function (e) {
        e.preventDefault();
        var $this = this;
        var $check = 0;
        $('.discussion-form-post .comment-box-title-post').removeClass('error').remove('.error');
        $('.discussion-form-post .comment-box-title-post .error').remove();
        $('.discussion-form-post .comment-box-message-post').removeClass('error').remove('.error');
        $('.discussion-form-post .comment-box-message-post .error').remove();
        $('.discussion-form-post .cm-multiple-radios-label .error').remove();

        if ($('.discussion-form-post').find('input[type="radio"]:checked').length > 0) {
            $check += 1;
        } else {
            $('.discussion-form-post .cm-multiple-radios-label').append('<span class="error">Bạn chưa đánh giá</span>');
        }
        if ($('.comment-box-title-post input').val() === '') {
            $('.discussion-form-post .comment-box-title-post').addClass('error').append('<span class="error">Bạn chưa nhập tiêu đề</span>');
        } else {
            $check += 1;
        }
        if ($('.comment-box-message-post textarea').val() === '') {
            $('.discussion-form-post .comment-box-message-post').addClass('error').append('<span class="error">Bạn chưa nhập Nội dung</span>');
        } else {
            $check += 1;
        }
        if ($check === 3) {
            $('.discussion-form-post').submit();
        }
    });
    $(document).on("click", ".read-link-action", function (e) {
        e.preventDefault();
        var $this = this;
        var active = $($this).attr('data-active');
        if (active == 0) {
            $(this).addClass('active');
            $($this).attr('data-active', 1);
        } else {
            $(this).removeClass('active');
            $($this).attr('data-active', 0);
        }
        var product_id = $($this).attr('data-product_id');
        // console.log(product_id);
        if (typeof product_id != 'undefined') {
            var $data = new Array();
            $data[product_id] = {
                'product_id': product_id,
                'amount': 1
            };
            $.ajax({
                url: "?dispatch=wishlist.add_custom_read",
                type: 'POST',
                data: 'product_data=' + product_id + '&active=' + active,
                success: function (data) {
                    Tygh.$.ceNotification('show', {
                        type: 'W',
                        title: 'Thông báo',
                        message: data
                    });
                }
            });
        }
    });

    $(document).on('click', '.btnIncrease', function(e) {
        e.preventDefault();
        var $btn = $(this);
        var $parent = $(this).closest('.input-group');
        var max_amount = $parent.attr('data-max-amount');
        var input = $parent.find('.cm-change-amount');
        var form = $(this).closest('form');

        input.updown({
            min: 1,
            max: max_amount,
            step: 1,
            shiftStep: max_amount
        });

        var $updown = input.data('updown');
        $updown.increase(e);
        $updown.triggerEvents();

        var inputVal = $updown.getInputVal();
        if (inputVal <= max_amount) {
            input.val(inputVal);
            form.find('.button_cart').trigger('click');
        }

        if (inputVal == max_amount) {
            $btn.attr('disabled', 'disabled');
        }
    });

    $(document).on('click', '.btnDecrease', function(e) {
        e.preventDefault();
        var $btn = $(this);
        var $parent = $(this).closest('.input-group');
        var max_amount = $parent.attr('data-max-amount');
        var input = $parent.find('.cm-change-amount');
        var form = $(this).closest('form');

        input.updown({
            min: 1,
            max: max_amount,
            step: 1,
            shiftStep: max_amount
        });

        var $updown = input.data('updown');
        $updown.decrease(e);
        $updown.triggerEvents();

        var inputVal = $updown.getInputVal();
        input.val(inputVal);
        form.find('.button_cart').trigger('click');

        if (inputVal == 1) {
            $btn.attr('disabled', 'disabled');
        }
    });
});

if (typeof select_district === "undefined") {

    select_district = function (state_code, country_code, address_type, district_id, elmChoose) {
        if (elmChoose == false) {
            var elm = $(".cm-district." + address_type);
        } else {
            var elm = elmChoose.parent().next().find('.cm-district');
        }

        var current_district = elm.parent().find('.current_district').val();
        elm.children().remove();
        elm.append("<option value=''>" + elm.parent().find(".select_district").val() + "</option>");
        $.ajax({
            url: "?dispatch=districts.ajax_district",
            dataType: "jsonp",
            data: {
                state_code: state_code,
                country_code: country_code
            },
            success: function (data) {
                if (data.length > 0) {
                    $('.select-districts input').hide().attr('disabled', 'disabled');
                    var $html = '';
                    $.each(data, function (i, item) {
                        /*
                         * Bug 1442 - Trang thông tin giao hàng: Chọn quận huyện, click Lưu --> lưu không thành công
                         * Fixer: Hà Phan Minh
                         * Date: 2014-04-08
                         * Part 2
                         */
                        if (current_district == item.district_id) {
                            if (item.district_id) {
                                $html = "<option value='" + item.district_id + "' selected='selected'>" + item.district_name + "</option>";
                            }
                        } else {
                            if (item.district_id) {
                                $html = "<option value='" + item.district_id + "'>" + item.district_name + "</option>";
                            }
                        }
                        elm.append($html);

                    });
                    select_ward(state_code, country_code, address_type, current_district, false, elm);
                } else {
                    // $('.select-districts select').hide().attr('disabled', 'disabled');
                    $('.select-districts input').show().attr('disabled', false);
                }
            }
        });
    };
}

if (typeof select_street === "undefined") {
    select_street = function (state_code, country_code, address_type, district_id) {
        $(".cm-street." + address_type).children().remove();
        $(".cm-street." + address_type).append("<option value=''>" + $("#select_street").val() + "</option>");
        $.ajax({
            url: "?dispatch=streets.ajax_street",
            dataType: "jsonp",
            data: {
                state_code: state_code,
                country_code: country_code,
                district_id: district_id
            },
            success: function (data) {
                if (data.length > 0) {
                    $('.select-streets input').hide().attr('disabled', 'disabled');
                    $('.select-streets select').show().attr('disabled', false);
                    $.each(data, function (i, item) {
                        $(".cm-street." + address_type).append("<option value='" + item.street_id + "'>" + item.street_name + "</option>");
                    });
                } else {
                    $('.select-streets select').hide().attr('disabled', 'disabled');
                    $('.select-streets input').show().attr('disabled', false);
                }
            }
        });
    };
}

if (typeof select_ward === "undefined") {
    select_ward = function (state_code, country_code, address_type, district_id, ward_id, elm) {
        if (elm == false) {
            var elmWard = $(".cm-ward." + address_type);
        } else {
            var elmWard = elm.parent().next().find('.cm-ward');
        }
        var current_ward = elmWard.parent().find('.current_ward').val();
        elmWard.children().remove();
        elmWard.append("<option value=''>" + elmWard.parent().find(".select_ward").val() + "</option>");
        $.ajax({
            url: "?dispatch=wards.ajax_ward",
            dataType: "jsonp",
            data: {
                state_code: state_code,
                country_code: country_code,
                district_id: district_id,
                ward_id: ward_id
            },
            success: function (data) {
                if (data.length > 0) {
                    $('.select-wards input').hide().attr('disabled', 'disabled');
                    $.each(data, function (i, item) {
                        if (current_ward == item.ward_id) {
                            elmWard.append("<option value='" + item.ward_id + "' selected='selected'>" + item.ward_name + "</option>");
                        } else {
                            elmWard.append("<option value='" + item.ward_id + "'>" + item.ward_name + "</option>");
                        }
                    });
                } else {
                    $('.select-wards input').show().attr('disabled', false);
                }
            }
        });
    };
}

$(document).ready(function () {
    /*tracking --------------------------------------------------------------------*/
    // $("#search-form-header").submit(function (event) {
    //     trackEvent('search', 'submit', $('.header-search-input').val());
    // });
    //tracking banner top
    // $('.page-index-index .banner-top1 a').click(function () {
    //     trackEvent('home slider top1', 'click', $(this).attr('title'));
    // });
    // $('#mySliderTabs_890 a').click(function () {
    //     trackEvent('home slider top1', 'click', $(this).attr('title'));
    // });
    // $('.page-index-index .banner-top2 a').click(function () {
    //     trackEvent('home slider top2', 'click', $(this).attr('title'));
    // });
    ///track best seller box right
    // $('.product-best-seller .product-title, .product-best-seller .product_thumb a').click(function () {
    //     trackEvent('home block bestseller', 'click', $(this).attr('title'));
    // });
    ///track home most reviewed box right
    // $('.home-most-reviewed .product-title, .home-most-reviewed .product_thumb a').click(function () {
    //     trackEvent('home most reviewed', 'click', $(this).attr('title'));
    // });
    // $('.home-new-release .product-title, .home-new-release .product_thumb a').click(function () {
    //     trackEvent('home new release', 'click', $(this).attr('title'));
    // });
    // $('.home-editor-pick .product-title, .home-editor-pick .product_thumb a').click(function () {
    //     trackEvent('home editor pick', 'click', $(this).attr('title'));
    // });
    // $('.product-top-week .product-title, .product-top-week .product_thumb a').click(function () {
    //     trackEvent('home best this week', 'click', $(this).attr('title'));
    // });
    // $('.home-block-press .product-title, .home-block-press .product_thumb a').click(function () {
    //     trackEvent('home block press', 'click', $(this).attr('title'));
    // });
    // $('.home-block-discount .product-title, .home-block-discount .product_thumb a').click(function () {
    //     trackEvent('home block discount', 'click', $(this).attr('title'));
    // });
    // $('.home-block-recent .product-title, .home-block-recent .product_thumb a').click(function () {
    //     trackEvent('home block recent view', 'click', $(this).attr('title'));
    // });
    // $('.top-panel-categories a').click(function () {
    //     trackEvent('main categories', 'click', $(this).attr('title'));
    // });
    // $('.breadcrumbs a').click(function () {
    //     trackEvent('breadcrumbs', 'click', $(this).attr('title'));
    // });
    // trang detail
    // $('.sach-mua-kem .product-title, .sach-mua-kem .product_thumb a').click(function () {
    //     trackEvent('product recommend', 'click', $(this).attr('title'));
    // });
    // $('.other-people-buy-this .product-title, .other-people-buy-this .product_thumb a').click(function () {
    //     trackEvent('detail block other people buy', 'click', $(this).attr('title'));
    // });
    // $('.similer-products .product-title, .similer-products .product_thumb a').click(function () {
    //     trackEvent('similer-products', 'click', $(this).attr('title'));
    // });
    // $('.page-products-search .product-container .product-title, .page-products-search .product-container .product_thumb a').click(function () {
    //     trackEvent('search result', 'click', $(this).attr('title'));
    // });
    ///tracking trang cate
    $('.page-products-discount_books  .product-title, .page-products-discount_books  .product_thumb a').click(function () {
        trackEvent('page products discount', 'click', $(this).attr('title'));
    });
    $('.page-products-bestsellers-week .product-title, .page-products-bestsellers-week .product_thumb a').click(function () {
        trackEvent('page products bestsellers week', 'click', $(this).attr('title'));
    });
    $('.page-products-bestsellers-month .product-title, .page-products-bestsellers-month .product_thumb a').click(function () {
        trackEvent('page products bestsellers month', 'click', $(this).attr('title'));
    });
    $('.page-products-bestsellers-year .product-title, .page-products-bestsellers-year .product_thumb a').click(function () {
        trackEvent('page products bestsellers year', 'click', $(this).attr('title'));
    });
    ///tracking trang moi phat hanh
    $('.page-products-home_new_book_release .product-title, .page-products-home_new_book_release .product_thumb a').click(function () {
        trackEvent('page products new release', 'click', $(this).attr('title'));
    });
    //tracking trang sach sap phat hanh
    $('.page-products-products_release_soon .product-title, .page-products-products_release_soon .product_thumb a').click(function () {
        trackEvent('page products release soon', 'click', $(this).attr('title'));
    });
    //tracking trang author
    // $('.page-authors-view .product-title, .page-authors-view .product_thumb a').click(function () {
    //     trackEvent('page products authors', 'click', $(this).attr('title'));
    // });
    // $('.page-publishers-view .product-title, .page-publishers-view .product_thumb a').click(function () {
    //     trackEvent('page products authors', 'click', $(this).attr('title'));
    // });
    //categories-sidebar
    // $('.categories-sidebar .publishers').click(function () {
    //     trackEvent('categories-sidebar publishers', 'click', $(this).attr('title'));
    // });
    // $('.categories-sidebar .category').click(function () {
    //     trackEvent('categories-sidebar category', 'click', $(this).attr('title'));
    // });
    // $('.categories-sidebar .author').click(function () {
    //     trackEvent('categories-sidebar author', 'click', $(this).attr('title'));
    // });
    //tracking author
    $('span.author').click(function () {
        trackEvent('author', 'click', $(this).val());
    });
    // $('.support-online-element .a').click(function () {
    //     trackEvent('support-online', 'click', $(this).attr('title'));
    // });
    // $('.page-products-view .publishers').click(function () {
    //     trackEvent('product detail publisher', 'click', $(this).attr('title'));
    // });
    // $('.page-products-view .author').click(function () {
    //     trackEvent('product detail author', 'click', $(this).attr('title'));
    // });
    /*end tracking --------------------------------------------------------------------*/
    $('.jcarousel-skin').hover(function () {
        $(this).find('.jcarousel-next-horizontal,.jcarousel-prev-horizontal').addClass('active-hover');
    }, function () {
        $(this).find('.jcarousel-next-horizontal,.jcarousel-prev-horizontal').removeClass('active-hover');
    });
    /*page product details --------------------------------------------------------------------*/
    //xu ly scroll trang detail
    var $detailNav = false;

    $(window).scroll(function () {
        if ($('#product-full-description').length > 0) {
            $detailNav = $('#product-full-description').offset().top;
        }
        var $detailDescription = false;
        if ($('#product-full-description').length > 0) {
            $detailDescription = $('#product-full-description').offset().top;
        }
        var $detailPress = false;
        if ($('#press_introduces_box_to').length > 0) {
            $detailPress = $('#press_introduces_box_to').offset().top;
        }
        var $detailVideo = false;
        if ($('#product-video-box').length > 0) {
            $detailVideo = $('#product-video-box').offset().top;
        }
        var $detailProduct_details = false;
        if ($('#product-details-box').length > 0) {
            $detailProduct_details = $('#product-details-box').offset().top;
        }
        var $detailComment = false;
        if ($('.product-comment-total-box').length > 0) {
            $detailComment = $('.product-comment-total-box').offset().top;
        }
        var $endNav = false;
        if ($('.end-tab-product-detail-nav').length > 0) {
            $endNav = $('.end-tab-product-detail-nav').offset().top;
        }
        var scrolled_val = $(document).scrollTop().valueOf();
        if (scrolled_val >= $detailNav) {
            $('.tab-product-detail-nav').addClass('tab-product-detail-nav-fullbar');
        } else {
            $('.tab-product-detail-nav').removeClass('tab-product-detail-nav-fullbar');
        }
        if (scrolled_val > $endNav) {
            $('.tab-product-detail-nav').removeClass('tab-product-detail-nav-fullbar');
        }
        $('.tab-product-detail-nav li').removeClass('active');
        $('.nav-product-full-description').addClass('active');
        if ($detailPress != false && scrolled_val >= $detailPress - 80) {
            $('.tab-product-detail-nav li').removeClass('active');
            $('.nav-press_introduces-box').addClass('active');
        }
        if ($detailProduct_details != false && scrolled_val >= $detailProduct_details - 100) {
            $('.tab-product-detail-nav li').removeClass('active');
            $('.nav-product-details-box').addClass('active');
        }
        if ($detailVideo != false && scrolled_val >= $detailVideo - 80) {
            $('.tab-product-detail-nav-fullbar li').removeClass('active');
            $('.nav-product-video-box').addClass('active');
        }
        if ($detailComment != false && scrolled_val >= $detailComment - 80) {
            $('.tab-product-detail-nav li').removeClass('active');
            $('.nav-product-comment-total-box').addClass('active');
        }
    });

    $('.press-description-wrap .readmore').click(function () {
        $(this).parent().find('.press-description').toggleClass('hidden');
        $(this).parent().find('.readless').toggleClass('hidden');
        $(this).parent().find('.readmore').toggleClass('hidden');
    });
    if ($('#product_detail_recommend_by_category').length > 0) {
        var product_id = $('#product_detail_recommend_by_category').attr('data-product_id');
        $.ajax({
            url: fn_url('products.get_recommend_by_category'),
            type: 'get',
            data: {
                product_id: product_id
            },
            dataType: 'json',
            beforeSend: function () {

            },
            success: function (response) {
                response = $.parseJSON(response.text);
                var rp_html = response.html;
                var rp_count = response.count;
                if (rp_count > 0) {
                    $("#product_detail_recommend_by_category").html(rp_html);
                    var elm_id = '#scroll_list_recommend_by_category_recent-view';
                    if ($(elm_id).length) {
                        //$(elm_id).show();
                        $(elm_id).jcarousel({
                            vertical: false,
                            size: rp_count,
                            scroll: 6,
                            animation: 'slow',
                            easing: 'swing',
                            auto: 0,
                            autoDirection: 'next',
                            wrap: 'circular',
                            initCallback: $.ceScrollerMethods.init_callback,
                            itemVisibleOutCallback: {
                                onAfterAnimation: $.ceScrollerMethods.in_out_callback
                            },
                            item_width: 171,
                            item_height: 280,
                            clip_width: 1007,
                            clip_height: 280,
                            item_count: rp_count,
                            buttonNextHTML: '<div><i class="vnb-bg icon-right-open-thin"></i></div>',
                            buttonPrevHTML: '<div><i class="vnb-bg icon-left-open-thin"></i></div>'
                        }).promise().done(function () {
                            if($(elm_id).hasClass('jcarousel-list-horizontal')){
                                $(elm_id).show();
                                fn_call_lazyload_image();
                            }
                        });

                    }
                } else {
                    $("#product_detail_recommend_by_category").fadeOut().remove();
                }
            }
        });
    }

    if ($('#product_detail_other-people-buy-this').length > 0) {
        var product_id = $('#product_detail_other-people-buy-this').attr('data-product_id');
        $.ajax({
            url: fn_url('products.get_recommend_other_people_buy_this'),
            type: 'get',
            data: {
                product_id: product_id
            },
            dataType: 'json',
            beforeSend: function () {

            },
            success: function (response) {
                response = $.parseJSON(response.text);
                var rp_html = response.html;
                var rp_count = response.count;
                if (rp_count > 0) {
                    $("#product_detail_other-people-buy-this").html(rp_html);
                    var elm_id = '#scroll_list_other-people-buy-this_recent-view';
                    if ($(elm_id).length) {
                        $(elm_id).jcarousel({
                            vertical: false,
                            size: rp_count,
                            scroll: 6,
                            animation: 'slow',
                            easing: 'swing',
                            auto: 0,
                            autoDirection: 'next',
                            wrap: 'circular',
                            initCallback: $.ceScrollerMethods.init_callback,
                            itemVisibleOutCallback: {
                                onAfterAnimation: $.ceScrollerMethods.in_out_callback
                            },
                            item_width: 171,
                            item_height: 280,
                            clip_width: 1007,
                            clip_height: 280,
                            item_count: rp_count,
                            buttonNextHTML: '<div><i class="vnb-bg icon-right-open-thin"></i></div>',
                            buttonPrevHTML: '<div><i class="vnb-bg icon-left-open-thin"></i></div>'
                        }).promise().done(function () {
                            if($(elm_id).hasClass('jcarousel-list-horizontal')){
                                $(elm_id).show();
                                fn_call_lazyload_image();
                            }
                        });
                        //$(elm_id).show().promise().done(function () {
                        //    console.log(elm_id);
                        //    $(elm_id).jcarousel({
                        //        vertical: false,
                        //        size: rp_count,
                        //        scroll: 6,
                        //        animation: 'slow',
                        //        easing: 'swing',
                        //        auto: 0,
                        //        autoDirection: 'next',
                        //        wrap: 'circular',
                        //        initCallback: $.ceScrollerMethods.init_callback,
                        //        itemVisibleOutCallback: {
                        //            onAfterAnimation: $.ceScrollerMethods.in_out_callback
                        //        },
                        //        item_width: 171,
                        //        item_height: 280,
                        //        clip_width: 1007,
                        //        clip_height: 280,
                        //        item_count: rp_count,
                        //        buttonNextHTML: '<div><i class="icon-right-open-thin"></i><i class="icon-down-open"></i></div>',
                        //        buttonPrevHTML: '<div><i class="icon-left-open-thin"></i><i class="icon-up-open"></i></div>'
                        //    }).promise().done(function () {
                        //        alert('xoad image');
                        //        fn_call_lazyload_image();
                        //    });
                        //});
                    }
                } else {
                    $("#product_detail_other-people-buy-this").fadeOut().remove();
                }
            }
        });
    }
    if ($('#product_detail_other-people-buy-this-small').length > 0) {
        var product_id = $('#product_detail_other-people-buy-this-small').attr('data-product_id');
        $.ajax({
            url: fn_url('products.get_recommend_other_people_buy_this'),
            type: 'get',
            data: {
                product_id: product_id,
                style: 'small'
            },
            dataType: 'json',
            beforeSend: function () {

            },
            success: function (response) {
                response = $.parseJSON(response.text);
                var rp_html = response.html;
                var rp_count = response.count;
                if (rp_count > 0) {
                    $("#product_detail_other-people-buy-this-small").html(rp_html);
                    var elm_id = '#scroll_list_other-people-buy-thissmall_recent-view';
                    if ($(elm_id).length) {
                        $(elm_id).show();
                        $(elm_id).jcarousel({
                            vertical: false,
                            size: rp_count,
                            scroll: 5,
                            animation: 'slow',
                            easing: 'swing',
                            auto: 0,
                            autoDirection: 'next',
                            wrap: 'circular',
                            initCallback: $.ceScrollerMethods.init_callback,
                            itemVisibleOutCallback: {
                                onAfterAnimation: $.ceScrollerMethods.in_out_callback
                            },
                            item_width: 140,
                            item_height: 270,
                            clip_width: 675,
                            clip_height: 270,
                            item_count: rp_count,
                            buttonNextHTML: '<div><i class="vnb-bg icon-right-open-thin"></i></div>',
                            buttonPrevHTML: '<div><i class="vnb-bg icon-left-open-thin"></i></div>'
                        }).promise().done(function () {
                            fn_call_lazyload_image();
                        });
                    }
                } else {
                    $("#product_detail_other-people-buy-this-small").fadeOut().remove();
                }
            }
        });
    }
    /*end page product details --------------------------------------------------------------------*/
    $('.vnb-tooltip').hover(function () {
        $('.vnb-tooltip-content').stop().fadeOut('fast');
        $(this).find('.vnb-tooltip-content').stop().fadeIn('fast');
    }, function () {
        $('.vnb-tooltip-content').stop().fadeOut('fast');
    });
    /*metro menu*/
    var $menu = $(".metro-dropdown-menu");
    $menu.menuAim({
        activate: activateSubmenu,
        deactivate: deactivateSubmenu,
        exitMenu: function () {
            $('li').removeClass('active-sub');
            $(".metro-dropdown-menu a").removeClass("maintainHover");
            $(".popover").css("display", "none");
            $('.metro-dropdown-menu').removeClass("active-metro-menu");
        },
        enter: activateSubmenu
    });
    function activateSubmenu(row) {
        //metro-dropdown-menu
        var $row = $(row),
                submenuId = $row.data("submenuId"),
                $submenu = $("#" + submenuId),
                height = $menu.outerHeight(),
                width = $menu.outerWidth();
        // Show the submenu
        $submenu.attr('style',$submenu.attr('data-style'));
        //
        $submenu.css({
            display: "block",
            top: -1,
            left: width - 1, // main should overlay submenu
            height: height - 4  // padding for main dropdown's arrow
        });
        if ($submenu.css('display') === 'block') {
            $('.metro-dropdown-menu').addClass("active-metro-menu");
            $row.addClass('active-sub');
        }
        // Keep the currently activated row's highlighted look
        $row.find("a").addClass("maintainHover");
    }

    function deactivateSubmenu(row) {
        var $row = $(row),
                submenuId = $row.data("submenuId"),
                $submenu = $("#" + submenuId);
        $submenu.css("display", "none");
        $row.closest('ul').find("li > a").removeClass("maintainHover");
        $row.closest('ul').find("li").removeClass('active-sub');
    }
    $(".dropdown-menu li").click(function (e) {
        e.stopPropagation();
    });

    $(document).click(function () {
        $(".popover").css("display", "none");
        $('.metro-dropdown-menu').removeClass("active-metro-menu");
        $("a.maintainHover").removeClass("maintainHover");
    });
    $(document).click(function () {
        $(".popover").css("display", "none");
        $('.metro-dropdown-menu').removeClass("active-metro-menu");
        $("a.maintainHover").removeClass("maintainHover");
    });

    $(document).on("click", ".checkout-one-step-services-plus .title", function (e) {

    });

    $(document).on("click", ".checkout-one-step-coupon .title", function (e) {

    });

    $(document).on("click", ".checkout-one-step-header .title", function (e) {
        e.preventDefault();
        var $this = $(this).find('.action-show-hide span');
        if ($this.length > 0) {
            var $content = $($this).parent().parent().parent().next();

            $($this).css({
                'border': 'none'
            });
            if ($($content).is(":visible")) {
                $($content).slideUp();
                var n = 0;
                $($this).css({
                    'transform': 'rotate(' + n + 'deg)',
                    '-ms-transform': 'rotate(' + n + 'deg)',
                    '-moz-transform': 'rotate(' + n + 'deg)',
                    '-o-transform': 'rotate(' + n + 'deg)'
                });
            } else {
                $($content).slideDown();
                var n = -180;
                $($this).css({
                    'transform': 'rotate(' + n + 'deg)',
                    '-ms-transform': 'rotate(' + n + 'deg)',
                    '-moz-transform': 'rotate(' + n + 'deg)',
                    '-o-transform': 'rotate(' + n + 'deg)'
                });
            }
        }
    });
    $(document).on("click", ".change-shipping-address", function (e) {
        e.preventDefault();
        var $this = this;
        $('.full-shipping-address').slideUp();
        $('.data-ct-address').slideDown();
        $(".select_state").each(function (index) {
            address_type = $(this).hasClass("cm-location-shipping") ? "cm-location-shipping" : "cm-location-billing";
            state_code = $(this).find('option:selected').val();
            var country_code = $(".cm-country." + address_type).val();
            select_district(state_code, country_code, address_type, false, $(this));
        });
        $('.customer-notes').hide();
        $('.data-ct-address *').removeAttr('disabled');
    });
    $(document).on("click", ".cancel_shipping_address", function (e) {
        e.preventDefault();
        var $this = this;
        $('.full-shipping-address').slideDown();
        $('.data-ct-address').slideDown().promise().done(function () {
            $('.data-ct-address').fadeOut();
        });
        $('.data-ct-address *').attr('disabled', 'disabled');
        $('.customer-notes').fadeIn();
    });
    $(document).on("click", ".views-icons a", function (e) {
        e.preventDefault();
        var $this = $(this);
        $this.closest('.views-icons').find('a').removeClass('active');
        $this.addClass('active');
    });
    $(document).on("click", "button.bt-thanh-toan, input.bt-thanh-toan", function (e) {
        var $this = this;
        $('.checkout_form').removeClass('cm-ajax cm-ajax-full-render');
    });
    $(document).on("click", "#place_order", function (e) {
        var $this = this;
        // if ($('.full-shipping-address').length > 0) {
            $('.checkout_form').removeClass('cm-ajax cm-ajax-full-render').promise().done(function () {
                $('.checkout_form').append('<input type="hidden" name="is_ajax" value="0"/><input type="hidden" name="full_render" value="N"/>').promise().done(function () {
                    $('#tygh_container').append('<div class="cm-notification-container"><div class="cm-notification-wrap"><div class="place_order_wrap">Đang đặt hàng...</div></div></div>');
                });
            });
        // } else {
        //     e.preventDefault();
        //     Tygh.$.checkFormValidator($('.checkout_form'));
        //     e.preventDefault();
        //     $(document).scrollTop(100);
        //     Tygh.$.ceNotification('show', {
        //         type: 'W',
        //         title: 'Thông báo',
        //         message: 'Bạn cần nhập và lưu lại thông tin Giao hàng '
        //     });
        // }
    });

    Tygh.$.ceEvent('on', 'ce.ajaxdone', function (elms, scripts, params, response_data, response_text) {
        if (typeof params.data['dispatch[checkout.place_order]'] !== 'undefined') {
            if (response_data && response_data.current_url) {
                window.location.href = response_data.current_url;
            }
        }
        fn_call_lazyload_image();

    });
    $(document).on("click", ".cover-check-all", function (e) {
        $('#customer_cover').find('input').prop("checked", true).promise().done(function () {
            $("#button_cart_update_steps").trigger('click');
        });
    });
    $(document).on("click", ".cover-uncheck-all", function (e) {
        $('#input_cover_uncheck_all').attr('value', 1);
        $('#customer_cover').find('input').prop("checked", false).promise().done(function () {
            $("#button_cart_update_steps").trigger('click');
        });
    });

    $(document).on("click", ".close_banner", function(e){
        $(this).closest('.tygh-top-banner-panel').remove();
        Cookies.set('top-banner-rain-coat', '1');
    });

    $(document).on("keypress", ".checkout_form input", function (event) {
        if (event.which == 13) {
            event.preventDefault();
            $("#button_cart_update_steps").trigger('click');
        }
    });

    fn_call_lazyload_image();

});

function trackEvent($name, $event, $value) {
    // _gaq.push(['_trackEvent', $name, $event, $value]);
}

function fn_call_lazyload_image(){
    $(".lazy-img").unveil($(window).height()/2, function() {
        $(this).load(function() {
            this.style.opacity = 1;
        });
    });
}

String.prototype.getSlug = function () {
    var $text = this;
    var $arr_search = ["á", "à", "ả", "ã", "ạ", "â", "ấ", "ầ", "ẩ", "ậ", "ẫ", "ă", "ắ", "ằ", "ẵ", "ặ", "ẳ"
                , "Á", "À", "Ả", "Ã", "Ạ", "Â", "Ấ", "Ầ", "Ẩ", "Ậ", "Ẫ", "Ă", "Ắ", "Ằ", "Ẵ", "Ặ", "Ẳ"
                , "é", "è", "ẻ", "ẽ", "ẹ", "ê", "ế", "ề", "ể", "ệ", "ễ"
                , "É", "È", "Ẻ", "Ẽ", "Ẹ", "Ê", "Ế", "Ề", "Ể", "Ệ", "Ễ"
                , "ó", "ò", "ỏ", "õ", "ọ", "ơ", "ớ", "ờ", "ở", "ỡ", "ợ", "ô", "ố", "ồ", "ổ", "ỗ", "ộ"
                , "Ó", "Ò", "Ỏ", "Õ", "Ọ", "Ơ", "Ớ", "Ờ", "Ở", "Ỡ", "Ợ", "Ô", "Ố", "Ồ", "Ổ", "Ỗ", "Ộ"
                , "ú", "ù", "ủ", "ũ", "ụ", "ư", "ứ", "ừ", "ử", "ữ", "ự"
                , "Ú", "Ù", "Ủ", "Ũ", "Ụ", "Ư", "Ứ", "Ừ", "Ử", "Ữ", "Ự"
                , "í", "ì", "ỉ", "ĩ", "ị", "ý", "ỳ", "ỷ", "ỹ", "ỵ"
                , "Í", "Ì", "Ỉ", "Ĩ", "Ị", "Ý", "Ỳ", "Ỷ", "Ỹ", "Ỵ"
                , "đ", "Đ"];
    var $arr_replace = ["a", "a", "a", "a", "a", "a", "a", "a", "a", "a", "a", "a", "a", "a", "a", "a", "a"
                , "A", "A", "A", "A", "A", "A", "A", "A", "A", "A", "A", "A", "A", "A", "A", "A", "A"
                , "e", "e", "e", "e", "e", "e", "e", "e", "e", "e", "e"
                , "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E"
                , "o", "o", "o", "o", "o", "o", "o", "o", "o", "o", "o", "o", "o", "o", "o", "o", "o"
                , "O", "O", "O", "O", "O", "O", "O", "O", "O", "O", "O", "O", "O", "O", "O", "O", "O"
                , "u", "u", "u", "u", "u", "u", "u", "u", "u", "u", "u"
                , "U", "U", "U", "U", "U", "U", "U", "U", "U", "U", "U"
                , "i", "i", "i", "i", "i", "y", "y", "y", "y", "y"
                , "I", "I", "I", "I", "I", "Y", "Y", "Y", "Y", "Y"
                , "d", "D"];
    return $text.str_replace_2($arr_search, $arr_replace);
};

String.prototype.str_replace_2 = function (find, replace) {
    var replaceString = this;
    var regex;
    for (var i = 0; i < find.length; i++) {
        regex = new RegExp(find[i], "g");
        replaceString = replaceString.replace(regex, replace[i]);
    }
    return replaceString;
};