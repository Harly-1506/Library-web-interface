!function(_,$){var loadedScripts={};!function($){var REQUEST_XML=1,REQUEST_IFRAME=2,REQUEST_COMET=3,REQUEST_JSONP_POST=5,QUERIES_LIMIT=1,queryStack=[],activeQueries=0,evalCache={},responseCache={},getScriptQueries=0,oldjQuery={},methods={request:function(e,r){if((r=r||{}).method=r.method||"get",r.data=r.data||{},r.message=r.message||_.tr("loading"),r.caching=r.caching||!1,r.hidden=r.hidden||!1,r.repeat_on_error=r.repeat_on_error||!1,r.force_exec=r.force_exec||!1,r.obj=r.obj||null,r.append=r.append||null,_.embedded&&(r.full_render=!0),r.full_render&&(r.data.full_render=r.full_render),void 0===r.data.security_hash&&void 0!==_.security_hash&&"post"==r.method.toLowerCase()&&(r.data.security_hash=_.security_hash),r.result_ids&&(r.data.result_ids=r.result_ids),r.skip_result_ids_check&&(r.data.skip_result_ids_check=r.skip_result_ids_check),activeQueries>=QUERIES_LIMIT)return queryStack.unshift(function(){methods.request(e,r)}),!0;!1===r.hidden&&$.toggleStatusBox("show",r.message);var a="";if(!0===r.caching&&(a=$.crc32(e+$.param(r.data))),a&&responseCache[a])a&&responseCache[a]&&_response(responseCache[a],r);else{var t=[],o=r.data.result_ids?r.data.result_ids.split(","):[];if(o.length>0){for(var s in o){var i=$("#"+o[s]);i.hasClass("cm-save-fields")&&(t[o[s]]=$(":input:visible",i).serializeArray())}r.saved_data=t}if(e){if(-1==(e=fn_query_remove(e,"result_ids")).indexOf("://")&&(e=_.current_location+"/"+e),r.obj&&r.obj.hasClass("cm-comet"))return r.url=e+"&result_ids="+r.result_ids+"&is_ajax="+REQUEST_COMET,transports.iframe(null,r,{is_comet:!0});activeQueries++;var n=$.support.cors||-1!=e.indexOf("://"+window.location.hostname)?"json":"jsonp";return $.ajax({type:r.method,url:e,dataType:n,cache:!0,data:r.data,xhrFields:{withCredentials:!0},success:function(e,t){a&&(responseCache[a]=e),_response(e,r)},error:function(a,t,o){if(r.repeat_on_error)return r.repeat_on_error=!1,methods.request(e,r),!1;if($.toggleStatusBox("hide"),!1===r.hidden&&o){var s=_.tr("error_ajax").str_replace("[error]",o);$.ceNotification("show",{type:"E",title:_.tr("error"),message:s})}},complete:function(e,r){(activeQueries--,queryStack.length)&&queryStack.shift()()}})}}return!1},submitForm:function(e,r){if(activeQueries>=QUERIES_LIMIT)return queryStack.unshift(function(){methods.submitForm(e,r)}),!0;var a={form:e,obj:r,callback:"ce.formajaxpost_"+e.prop("name")};$.ceNotification("closeAll"),$.toggleStatusBox("show");var t=_getOptions(e,a);return t.force_exec&&(a.force_exec=!0),t.full_render&&e.append('<input type="hidden" name="full_render" value="Y">'),e.append('<input type="hidden" name="is_ajax" value="'+("iframe"==t.transport?t.is_comet?REQUEST_COMET:REQUEST_IFRAME:"jsonpPOST"==t.transport?REQUEST_JSONP_POST:REQUEST_XML)+'">'),transports[t.transport](e,a,t)},inProgress:function(){return 0!==activeQueries},clearCache:function(){return responseCache={},!0}},transports={iframe:function(form,params,options){var iframe=$('<iframe name="upload_iframe" src="javascript: false;" class="hidden"></iframe>').appendTo(_.body);return activeQueries++,options.is_comet&&$("#comet_container_controller").ceProgress("init"),iframe.on("load",function(){var response={},self=$(this);activeQueries--,null!==self.contents().text()&&eval("var response = "+self.contents().find("textarea").val()),response=response||{},_response(response,params),options.is_comet&&$("#comet_container_controller").ceProgress("finish"),self.remove()}),form?form.prop("target","upload_iframe"):params.url&&iframe.prop("src",params.url),!0},xml:function(e,r){var a=$(":input",e).serializeObject();return r.obj&&r.obj.prop("name")&&(a[r.obj.prop("name")]=r.obj.val()),r.method=e.prop("method"),r.data=a,r.result_ids=e.data("caTargetId"),methods.request(e.prop("action"),r),!1},jsonpPOST:function(e,r,a){$.receiveMessage(function(e){activeQueries--,a.is_comet&&$("#comet_container_controller").ceProgress("finish"),t.remove(),_response($.parseJSON(e.data),r)});var t=$('<iframe name="upload_iframe" src="javascript: false;" class="hidden"></iframe>').appendTo(_.body);return activeQueries++,a.is_comet&&$("#comet_container_controller").ceProgress("init"),e?e.prop("target","upload_iframe"):r.url&&t.prop("src",r.url),!0}};function _getOptions(e,r){var a=e.hasClass("cm-comet")||r.obj&&r.obj.hasClass("cm-comet"),t="xml";return $.support.cors||-1==e.prop("action").indexOf("//")||-1!=e.prop("action").indexOf("//"+window.location.hostname)||"post"!=e.prop("method")?(a||"multipart/form-data"==e.prop("enctype")&&e.find('input[type=file][value!=""]').length)&&(t="iframe"):t="jsonpPOST",{full_render:e.hasClass("cm-ajax-full-render"),is_comet:a,force_exec:e.hasClass("cm-ajax-force"),transport:t}}function _response(e,r){(r=r||{}).force_exec=r.force_exec||!1,r.pre_processing=r.pre_processing||{};var a,t=new RegExp("<script[^>]*>([-ï¿¿]*?)<\/script>","img"),o=[],s=e||{},i=null,n=[],c=[];if(r.pre_processing&&"function"==typeof r.pre_processing&&r.pre_processing(s,r),s.force_redirection)return $.toggleStatusBox("hide"),$.redirect(s.force_redirection),!0;if(s.html)for(var l in s.html)if(1==(a=$("#"+l)).length){if(-1!=s.html[l].indexOf("<form")&&a.parents("form").length&&$(_.body).append(a),o=s.html[l].match(t),r.append?a.append(o?s.html[l].replace(t,""):s.html[l]):a.html(o?s.html[l].replace(t,""):s.html[l]),void 0!==r.saved_data&&void 0!==r.saved_data[l]){var p=[];for(var d in r.saved_data[l])p[r.saved_data[l][d].name]=r.saved_data[l][d].value;$("input:visible, select:visible",a).each(function(e,r){jelm=$(r),void 0===p[jelm.prop("name")]||jelm.parents().hasClass("cm-skip-save-fields")||("radio"==jelm.prop("type")?jelm.val()==p[jelm.prop("name")]&&jelm.prop("checked",!0):jelm.val(p[jelm.prop("name")]),jelm.trigger("change"))})}$.trim(a.html())?a.parents(".hidden.cm-hidden-wrapper").removeClass("hidden"):a.parents(".cm-hidden-wrapper").addClass("hidden");var u=null,m=null;if(o&&(m=(u=$(o.join("\n"))).filter("[src]"),i=i?i.add(u.filter(":not([src])")):u.filter(":not([src])"),m.length))for(d=0;d<m.length;d++){var f=m.eq(d).prop("src");loadedScripts[f]&&!m.eq(d).hasClass("cm-ajax-force")||n.push($.getScript(f))}$.ceDialog("inside_dialog",{jelm:a})&&$.ceDialog("reload_parent",{jelm:a,resizable:!1}),c.push(a)}var h=function(){$.ceEvent("trigger","ce.ajaxdone",[c,i,r,s,e.text||""])};n.length?$.when.apply(null,n).then(h):h()}var ajax=$.ajax;$.ajax=function(e){if(e.dataType&&"script"==e.dataType){var r=e.url;if(loadedScripts[r])return!1;loadedScripts[e.url]=!0}return ajax(e)},$.getScript=function(e,r){return e=-1==e.indexOf("//")?_.current_location+"/"+e:e,_.otherjQ&&0===getScriptQueries&&(oldjQuery=jQuery,jQuery=_.$),getScriptQueries++,$.ajax({type:"GET",url:e,success:function(e,a,t){getScriptQueries--,_.otherjQ&&0===getScriptQueries&&(_.$=jQuery,jQuery=oldjQuery),r&&r(e,a,t)},dataType:"script",cache:!0})},$.ceEvent("on","ce.ajaxdone",function(e,r,a,t,o){var s;if(a.on_ajax_done&&"function"==typeof a.on_ajax_done&&a.on_ajax_done(t,a,o),r)for(s=0;s<r.length;s++){var i=$.crc32(r.eq(s).html());(!evalCache[i]||a.force_exec||r.eq(s).hasClass("cm-ajax-force"))&&($.globalEval(r.eq(s).html()),evalCache[i]=!0)}t.debug_info&&console.log(t.debug_info);var n=a.save_history&&(!a.obj||a.obj&&!1===$.ceDialog("inside_dialog",{jelm:a.obj}));if(!a.skip_history&&t.current_url&&(_.embedded||n)){var c=a;n||(c.result_ids=_.container),$.ceHistory("load",t.current_url,c,!0)}for(s=0;s<e.length;s++)$.commonInit(e[s]),e[s].prop("id")!=_.container||_.scrolling||$.scrollToElm(e[s]);a.form&&($("input[name=is_ajax]",a.form).remove(),$("input[name=full_render]",a.form).remove(),(a.form.hasClass("cm-disable-empty")||a.form.hasClass("cm-disable-empty-files"))&&$("input.cm-disabled",a.form).prop("disabled",!1).removeClass("cm-disabled")),a.callback&&$.isFunction(a.callback)?a.callback(t,a,o):$.ceEvent("trigger",a.callback,[t,a,o]),_.translate_mode&&$.init_design_mode(),a.keep_status_box||$.toggleStatusBox("hide"),t.notifications&&$.ceNotification("showMany",t.notifications)}),$.ceAjax=function(e){return methods[e]?methods[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void $.error("ty.ajax: method "+e+" does not exist"):methods.init.apply(this,arguments)}}($),$(document).ready(function(){$("script").each(function(){var e=$(this).prop("src");e&&(loadedScripts[e]=!0)}),"undefined"!=typeof ajax_callback_data&&ajax_callback_data&&($.globalEval(ajax_callback_data),ajax_callback_data=!1)})}(Tygh,Tygh.$);